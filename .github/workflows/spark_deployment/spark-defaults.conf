# Core Spark Configuration
spark.master                                   local[4]
spark.driver.memory                           8g
spark.executor.memory                         4g
spark.memory.fraction                         0.7
spark.memory.storageFraction                  0.3
spark.memory.offHeap.enabled                  true
spark.memory.offHeap.size                     2147483648

# Parallelism and Partitioning
spark.sql.shuffle.partitions                  8
spark.default.parallelism                     8
spark.sql.files.maxPartitionBytes            134217728

# Performance Optimization
spark.sql.adaptive.enabled                    true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled          true

# Serialization
spark.serializer                             org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max              268435456

# AWS S3 Configuration
spark.hadoop.fs.s3a.impl                     org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.access.key               ${AWS_ACCESS_KEY_ID}
spark.hadoop.fs.s3a.secret.key               ${AWS_SECRET_ACCESS_KEY}
spark.hadoop.fs.s3a.session.token            ${AWS_SESSION_TOKEN}
spark.hadoop.fs.s3a.aws.credentials.provider org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider
spark.hadoop.fs.s3a.endpoint                 s3.eu-west-1.amazonaws.com
spark.hadoop.fs.s3a.path.style.access        false
spark.hadoop.fs.s3a.region                   eu-west-1

# S3A Connection Management
spark.hadoop.fs.s3a.connection.maximum       20
spark.hadoop.fs.s3a.connection.timeout       300000
spark.hadoop.fs.s3a.threads.max             8
spark.hadoop.fs.s3a.connection.ssl.enabled   true

# Iceberg Catalog Configuration
spark.sql.extensions                         org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.glue                       org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.glue.catalog-impl          org.apache.iceberg.aws.glue.GlueCatalog
spark.sql.catalog.glue.warehouse             s3a://dbt-spark-iceberg/github-integration-testing
spark.sql.catalog.glue.io-impl               org.apache.iceberg.aws.s3.S3FileIO
spark.sql.defaultCatalog                     glue

# Network timeouts
spark.network.timeout                        300000
spark.sql.broadcastTimeout                   300000