# Spark Master Configuration
spark.master                                   local[*]

# Storage and Catalog Configuration
spark.sql.warehouse.dir                        s3a://dbt-spark-iceberg/github-integration-testing
spark.sql.catalog.glue                         org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.glue.catalog-impl            org.apache.iceberg.aws.glue.GlueCatalog
spark.sql.catalog.glue.warehouse               s3a://dbt-spark-iceberg/github-integration-testing
spark.sql.catalog.glue.io-impl                 org.apache.iceberg.aws.s3.S3FileIO
spark.sql.defaultCatalog                       glue
spark.sql.catalog.glue.database                dbt-spark-iceberg

# AWS S3 Configuration
spark.hadoop.fs.s3a.impl                       org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.access.key                 ${AWS_ACCESS_KEY_ID}
spark.hadoop.fs.s3a.secret.key                 ${AWS_SECRET_ACCESS_KEY}
spark.hadoop.fs.s3a.endpoint                   s3.eu-west-1.amazonaws.com
spark.hadoop.fs.s3a.path.style.access          true
spark.hadoop.fs.s3a.region                     eu-west-1
spark.hadoop.fs.s3a.aws.region                 eu-west-1
spark.hadoop.com.amazonaws.services.s3.enableV4 true
spark.hadoop.fs.s3a.aws.credentials.provider   org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider

# Glue Configuration
spark.hadoop.hive.metastore.client.factory.class com.amazonaws.glue.catalog.metastore.AWSGlueDataCatalogHiveClientFactory

# Memory and Resource Configuration
spark.driver.memory                            8g
spark.executor.memory                          4g
spark.memory.fraction                          0.7
spark.memory.storageFraction                   0.3
spark.driver.maxResultSize                     2g
spark.sql.shuffle.partitions                   8
spark.default.parallelism                      8

# Performance Optimization
spark.sql.adaptive.enabled                     true
spark.sql.adaptive.coalescePartitions.enabled  true
spark.sql.adaptive.skewJoin.enabled           true
spark.sql.files.maxPartitionBytes             134217728
spark.serializer                              org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max               256m
spark.sql.inMemoryColumnarStorage.compressed  true
spark.sql.inMemoryColumnarStorage.batchSize   10000

# Timeout and Network Configuration
spark.network.timeout                          300s
spark.sql.broadcastTimeout                     300s

# Event Logging
spark.eventLog.enabled                         true
spark.eventLog.dir                            /tmp/spark-events
spark.eventLog.rolling.enabled                true
spark.eventLog.rolling.maxFileSize            128m

# Memory Management
spark.memory.offHeap.enabled                  true
spark.memory.offHeap.size                     2g

# Garbage Collection
spark.executor.extraJavaOptions               -XX:+UseG1GC -XX:G1HeapRegionSize=16M -XX:+UseCompressedOops